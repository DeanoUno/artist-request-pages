<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Artist Request Page</title>
</head>
<body>
  <div id="app">
    <h1>Loading...</h1>
  </div>

  <script>
    const sheetId = "1BFp0JA-h679UsgzDUwH7TuiLFsvFM17kYDX0ILY2_G2U"; // your actual config sheet ID
    const configUrl = `https://opensheet.elk.sh/${sheetId}/Artist%20Map`;

    // Get ?artist=xyz from URL
    const urlParams = new URLSearchParams(window.location.search);
    const artistId = urlParams.get('artist') || "dmvmar"; // fallback to default

    async function loadArtistData() {
      const res = await fetch(configUrl);
      const data = await res.json();

      const artist = data.find(row => row.st_id === artistId);
      if (!artist) {
        document.getElementById('app').innerHTML = `<p>Artist not found.</p>`;
        return;
      }

      document.getElementById('app').innerHTML = `
        <h1>${artist.artist_name}</h1>
        <p>${artist.welcome_message}</p>
        <form id="songRequestForm">
          <input name="name" placeholder="Your Name" />
          <input name="song" placeholder="Song Title" />
          <input name="note" placeholder="Message (Optional)" />
          <input type="hidden" name="artistId" value="${artist.st_id}" />
          <button type="submit">Request</button>
        </form>
        <div id="thankYou" style="display:none;">${artist.thank_you_message}</div>
        <p><a href="${artist.tip_venmo}" target="_blank">Tip via Venmo</a></p>
      `;

      document.getElementById('songRequestForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = Object.fromEntries(new FormData(this).entries());

        await fetch("https://script.google.com/macros/s/AKfycbx7dk18igyE7QS2cScishwufWwPtBHV-mZ1rR4IKHZJePGcBWae9DgfY8S5Lhk8mCbS/exec", {
          method: "POST",
          body: JSON.stringify(formData),
          headers: { "Content-Type": "application/json" }
        });

        this.style.display = "none";
        document.getElementById("thankYou").style.display = "block";
      });
    }

    loadArtistData();
  </script>
</body>
</html>
